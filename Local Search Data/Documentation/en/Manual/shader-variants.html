<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
					function OptanonWrapper() { }
				</script><script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual:  Shader variants</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://docs.unity3d.com/StaticFilesConfig/UnityVersionsInfo.js"></script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=1631881794"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=1631881794"></script><script type="text/javascript" src="docdata/toc.js?ts=1631881794"></script><script type="text/javascript" src="docdata/global_toc.js?ts=1631881794"></script><link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=1631881794">
<link rel="stylesheet" href="../StaticFilesManual/css/prism.css">
<script src="../StaticFilesManual/js/prism.js"></script><script src="/StaticFilesConfig/feedback/feedback.js"></script><script src="../StaticFilesManual/js/jquery.sidebar.min.js"></script><link rel="stylesheet" href="../StaticFilesManual/css/mobileoptimisation.css">
<script src="../StaticFilesManual/js/mobileoptimisation.js"></script>
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div id="DocsAnalyticsData" data-area="none" data-pagetype="manual"></div>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity.com/">unity3d.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="toggle version-number" id="VersionNumber" data-target=".otherversionscontent">
                                Version: <b>2020.3</b><div class="otherversionscontent" id="OtherVersionsContent" style="display: none;">
<ul id="OtherVersionsContentUl"></ul>
<div id="otherVersionsLegend"><ul>
<li>
<div id="supportedColour" class="legendBox"></div>Supported</li>
<li>
<div id="notFoundColour" class="legendBox"></div>Legacy</li>
</ul></div>
</div>
<div id="VersionSwitcherArrow" class="arrow versionSwitcherArrow"></div>
</div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/shader-variants.html">English</a></li>
<li><a href="/cn/current/Manual/shader-variants.html">中文</a></li>
<li><a href="/ja/current/Manual/shader-variants.html">日本語</a></li>
<li><a href="/es/current/Manual/shader-variants.html">Español</a></li>
<li><a href="/kr/current/Manual/shader-variants.html">한국어</a></li>
<li><a href="/ru/current/Manual/shader-variants.html">Русский</a></li>
</ul></div>
</div></div>
</div></div>
<div class="mobileLogo"><a href="https://docs.unity3d.com"></a></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc" id="customScrollbar">
<h2>Unity Manual</h2>
<div class="search-form sidebar-search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" id="mobileSearchBtn" class="submit" value="Search">
</form></div>
<div class="toggle version-number sidebar-version-switcher" id="VersionNumber" data-target=".otherversionscontent"><form id="otherVersionsContentMobileForm"><div class="ui-field-contain">
<label for="select-native-4">Version: 2020.3</label><select name="select-native-4" id="versionsSelectMobile"><option>Select a different version</option>
<optgroup id="versionsWithThisPageMobile" label="Versions with this page"></optgroup>
<optgroup id="versionsWithoutThisPageMobile" label="Versions without this page"></optgroup></select>
</div></form></div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/shader-variants.html">English</a></li>
<li><a href="/cn/current/Manual/shader-variants.html">中文</a></li>
<li><a href="/ja/current/Manual/shader-variants.html">日本語</a></li>
<li><a href="/es/current/Manual/shader-variants.html">Español</a></li>
<li><a href="/kr/current/Manual/shader-variants.html">한국어</a></li>
<li><a href="/ru/current/Manual/shader-variants.html">Русский</a></li>
</ul></div>
</div></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html"> Unity User Manual 2020.3 (LTS)</a></li>
<li><a href="Graphics.html">Graphics</a></li>
<li><a href="Shaders.html"> Shaders</a></li>
<li><a href="ShadersOverview.html">This section contains information on the fundamentals of working with shaders in Unity.</a></li>
<li><a href="shader-variants-and-keywords.html"> Shader variants and shader keywords</a></li>
<li> Shader variants</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="shader-variants-and-keywords.html"></a></span><div class="tip"> Shader variants and shader keywords</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="shader-keywords.html"></a></span><div class="tip"> Shader keywords</div>
</div>
</div></div>
<div id="_leavefeedback"></div>
<h1>Shader variants</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Unity compiles your <span class="tooltip"><strong>shader</strong><span class="tooltiptext">A program that runs on the GPU. <a class="tooltipMoreInfoLink" href="Shaders.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#Shader">Glossary</a></span></span></span> source files into individual shader programs. Each compiled shader program has one or more <strong>variants</strong>. Variants are versions of the shader program that work with different combinations of <a href="shader-keywords.html">shader keywords</a>. At runtime, when Unity renders geometry, it uses the variant that matches the current requirements. For more information on how Unity loads and uses shader variants, see <a href="shader-loading.html">Shader loading</a>.</p>

<p>Shader variants can improve performance, because they result in shader programs that contain only the code that is needed for the current material, at the current time. Common things to optimize in this way are texture reads, vertex inputs, interpolators, or complex code such as loops. Additionally, the shader programs themselves are smaller.</p>

<p>Shader variants can also improve your workflow, because they allow you to use the same shader source file in different ways. For example, you can configure settings for different materials, define functionality for different hardware, and dynamically change the behaviour of shaders at runtime.</p>

<p>However, there are potential downsides. It’s easy to create a very large number of variants, and this can result in the following:</p>

<ul>
<li>Increased build times, file sizes, runtime memory usage, and loading times.</li>
<li>Greater complexity when manually preloading (“prewarming”) shaders.</li>
</ul>

<p>In larger projects, these issues can lead to significant problems with performance and workflow. It is therefore very important to understand how shader variants work, and how to exclude (“strip”) unneeded variants from compilation.</p>

<p>Shaders with a very large number of variants are called “mega shaders” or “uber shaders”. Unity’s Standard Shader is an example of such a shader.</p>

<p><a name="number-shader-variants"></a></p>

<h2>Number of shader variants</h2>

<p>At build time, Unity compiles one set of shader variants for each graphics API for the current build target. The number of variants for each combination of graphics API and build target depends on your shader source files, and your use of shader keywords.</p>

<h3>Graphics APIs</h3>

<p>Unity compiles one set of shader variants for each graphics API in the list for the current build target. The shaders differ for each combination of build target and graphics API; for example, Unity compiles different shaders for Metal on <span class="tooltip"><strong>iOS</strong><span class="tooltiptext">Apple’s mobile operating system. <a class="tooltipMoreInfoLink" href="iphone.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#iOS">Glossary</a></span></span></span> than for Metal on macOS.</p>

<p>Some shader programs or keywords might only target a given graphics API or a given build target, so the total number of variants for each combination of graphics API and build target can differ; however, the process for compiling these variants is the same.</p>

<p>To view and edit the list of graphics APIs for your current build target, use the <span class="tooltip"><a class="tooltipMoreInfoLink" href="class-PlayerSettings.html">Player Settings</a><span class="tooltiptext">Settings that let you set various player-specific options for the final game built by Unity. <a href="class-PlayerSettings.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#PlayerSettings">Glossary</a></span></span></span> window, or the <a href="../ScriptReference/PlayerSettings.html">PlayerSettings</a> API.</p>

<h3>Number of shader programs</h3>

<p>Unity must determine how many shader programs to compile for the current combination of build target and graphics API.</p>

<p>For each shader source file that is included in your build, Unity determines how many unique shader programs it defines:</p>

<ul>
<li>A compute shader asset defines a single shader program.</li>
<li>In a hand-coded shader, the number of shader programs depends on your code. The total comprises:

<ul>
<li>All shader stages in all Passes in the source file itself. For example, each vertex stage defines one shader program; each fragment stage defines one shader program; and so on.</li>
<li>All shader stages in all Passes in <span class="tooltip"><strong>dependencies</strong><span class="tooltiptext">In the context of the Package Manager, a dependency is a specific package version (expressed in the form <code>package_name@package_version</code>) that a project or another package requires in order to work. Projects and packages use the <strong>dependencies</strong> attribute in their manifests to define the set of packages they require. For projects, these are considered <strong>direct</strong> dependencies; for packages, these are <strong>indirect</strong>, or transitive, dependencies. <a class="tooltipMoreInfoLink" href="upm-dependencies.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#Dependency">Glossary</a></span></span></span> of the source file. This comprises all <a href="SL-Fallback.html">fallback shaders</a>, and all Passes that are included using the <a href="SL-UsePass.html">UsePass command</a>.</li>
</ul>
</li>
<li>In a Shader Graph shader, the number of shader programs depends on the code that Unity generates from your graph. To see the shader code that Unity generates, context-click the Shader Graph asset and select <strong>See generated code</strong>. You can then determine the total number of shader programs in the same way that you would for a hand-coded shader.</li>
</ul>

<p>
<strong>Note:</strong> A shader source file is included in a build if it is referenced in a <span class="tooltip"><strong>scene</strong><span class="tooltiptext">A Scene contains the environments and menus of your game. Think of each unique Scene file as a unique level. In each Scene, you place your environments, obstacles, and decorations, essentially designing and building your game in pieces. <a class="tooltipMoreInfoLink" href="CreatingScenes.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#Scene">Glossary</a></span></span></span> in that build, referenced by something in the <strong>Resources</strong> folder, or included in the <strong>Always-included shaders</strong> section of the <a href="class-GraphicsSettings.html">Graphics Settings</a> window.</p>

<h3>Keywords that affect a shader program</h3>

<p>When Unity has determined how many shader programs it must compile for the current build target and graphics API, it then determines how many shader variants it must compile for each shader program.</p>

<p>For each shader program, Unity determines the combination of shader keywords that affect it. This comprises:</p>

<ul>
<li>The sets of shader keywords that are defined in the source file for that shader. For more information, see <a href="shader-keywords.html#declaring-keywords">Declaring shader keywords</a>.</li>
<li>The sets of shader keywords that Unity adds automatically. For more information, see <a href="shader-keywords.html#predefined-shader-keywords">Unity’s predefined shader keywords</a>.</li>
</ul>

<p>The number of shader variants that Unity compiles for a shader program is the product of the keyword sets; that is to say, Unity compiles one variant for every combination that includes one element from each set. </p>

<p>For example, this set contains three keywords:</p>

<ul>
<li>COLOR_RED</li>
<li>COLOR_GREEN</li>
<li>COLOR_BLUE</li>
</ul>

<p>This set contains four keywords:</p>

<ul>
<li>QUALITY_LOW</li>
<li>QUALITY_MEDIUM</li>
<li>QUALITY_HIGH</li>
<li>QUALITY_ULTRA</li>
</ul>

<p>A shader program affected by those keywords will result in the following twelve variants:</p>

<ul>
<li>COLOR_RED and QUALITY_LOW</li>
<li>COLOR_RED and QUALITY_MEDIUM</li>
<li>COLOR_RED and QUALITY_HIGH</li>
<li>COLOR_RED and QUALITY_ULTRA</li>
<li>COLOR_GREEN and QUALITY_LOW</li>
<li>COLOR_GREEN and QUALITY_MEDIUM</li>
<li>COLOR_GREEN and QUALITY_HIGH</li>
<li>COLOR_GREEN and QUALITY_ULTRA</li>
<li>COLOR_BLUE and QUALITY_LOW</li>
<li>COLOR_BLUE and QUALITY_MEDIUM</li>
<li>COLOR_BLUE and QUALITY_HIGH</li>
<li>COLOR_BLUE and QUALITY_ULTRA</li>
</ul>

<p>The number of variants that Unity compiles can grow very rapidly as you add more sets of keywords. For example, consider a fairly typical use case, where a shader has a number of sets of keywords that contain two keywords each (<code>&lt;feature name&gt;_ON</code> and <code>&lt;feature name&gt;_OFF</code>). If the shader has two such sets of keywords, this results in four variants. If the shader has ten such sets of keywords, this results in 1024 variants.</p>

<p><a name="deduplication"></a></p>

<h3>Deduplication of shader variants</h3>

<p>After compilation, Unity automatically identifies identical variants within the same Pass, and ensures that these identical variants point to the same bytecode. This is called <strong>deduplication</strong>.</p>

<p>Deduplication prevents identical variants in the same Pass from increasing file size; however, identical variants still result in wasted work during compilation, and increased memory usage and shader loading times at runtime. With this in mind, it is always best to strip unneeded variants.</p>

<p><a name="stripping-shader-variants"></a></p>

<h2>Stripping shader variants</h2>

<p>You can prevent shader variants from being compiled. This is called <strong>stripping</strong>. Stripping unneeded variants can greatly reduce build times, file size, shader loading times, and runtime memory usage. In larger projects, or projects with complex shaders, this is a very important consideration.</p>

<h3>Limiting shader variants when you declare shader keywords</h3>

<p>The way that you declare shader keywords can limit the number of variants that they produce:</p>

<ul>
<li>Use <code>shader_feature</code> instead of <code>multi_compile</code> where possible.</li>
<li>Ensure that you don’t define unused keywords with <code>multi_compile</code>.</li>
<li>Indicate when shader keywords only affect a given shader stage.</li>
</ul>

<p>For information on doing this in hand-coded shaders, see <a href="SL-MultipleProgramVariants.html">Declaring and using shader keywords in HLSL</a>. For information on doing this in Shader Graph, see <a href="https://docs.unity3d.com/Packages/com.unity.shadergraph@latest?subfolder=/manual/Blackboard.html">Shader Graph: Blackboard</a>.</p>

<h3>Stripping shader variants in the Editor UI</h3>

<p>There are several places in the Unity Editor <span class="tooltip"><strong>UI</strong><span class="tooltiptext">(User Interface) Allows a user to interact with your application. Unity currently supports three UI systems. <a class="tooltipMoreInfoLink" href="UI-system-compare.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#UI">Glossary</a></span></span></span> where you can configure shader stripping:</p>

<ul>
<li>In the <a href="class-GraphicsSettings.html#stripping">Graphics Settings window</a>, configure the settings in the <strong>Shader stripping</strong> section:</li>
<li>Ensure that no unneeded shaders are included in the <strong>Always-included shaders</strong> setting.</li>
<li>Strip variants relating to GPU instancing, lightmapping, and fog.</li>
<li>In the Built-in <span class="tooltip"><strong>Render Pipeline</strong><span class="tooltiptext">A series of operations that take the contents of a Scene, and displays them on a screen. Unity lets you choose from pre-built render pipelines, or write your own. <a class="tooltipMoreInfoLink" href="render-pipelines.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#Renderpipeline">Glossary</a></span></span></span>, if it is not important that your Tier settings are different, ensure that they are identical to each other. For more information, see <a href="graphics-tiers.html">Graphics tiers</a>.</li>
<li>In the Universal Render Pipeline (URP), disable unused features in the URP Asset. For more information, see <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@latest?subfolder=/manual/shader-stripping.html">Shader stripping</a>.</li>
</ul>

<p><a name="stripping-scripts"></a></p>

<h3>Stripping shader variants using Editor scripts</h3>

<p>For shader variants that you can’t strip in other ways, you can use the following APIs in an Editor script to perform build-time stripping:</p>

<ul>
<li>
<a href="../ScriptReference/Build.IPreprocessShaders.OnProcessShader.html">IPreprocessShaders.OnProcessShader</a>: receive a callback before Unity compiles a graphics shader Pass into a build.</li>
<li>
<a href="ScriptRef:Build.IPreprocessComputeShaders.OnProcessComputeShader">IPreprocessComputeShaders.OnProcessComputeShader</a>: receive a callback before Unity compiles a compute shader into a build.</li>
</ul>

<p>For more information on this subject, see the Unity blog post <a href="https://blogs.unity3d.com/2018/05/14/stripping-scriptable-shader-variants/">Stripping scriptable shader variants</a>
</p>
<div id="_content"></div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="shader-variants-and-keywords.html"></a></span><div class="tip"> Shader variants and shader keywords</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="shader-keywords.html"></a></span><div class="tip"> Shader keywords</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright © 2021 Unity Technologies. Publication Date: 2021-09-17.</div>
<div class="menu">
<a href="https://learn.unity.com/">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
